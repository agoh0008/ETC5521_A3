---
title: "FAIRY PENGUIN REPORT"
author: "INXS - Alexandra Goh & Bagas Trilaksonoaji"
format: html
execute: 
  warning: false
  message: false
bibliography: references.bib
csl: apa.csl
---

```{r image, echo=FALSE, out.width = '100%'}
knitr::include_graphics("image.jpg")
```

## Introduction

```{r message = FALSE, warning = FALSE, echo = FALSE}

library(tidyverse)
library(galah)
library(lubridate)
library(kableExtra)
library(scales)
library(plotly)
library(RColorBrewer)
library(ggbeeswarm)
library(rnoaa)
library(viridis)
library(nullabor)
library(DT)
library(ggthemes)
library(ggmap)
library(tmaptools) 

```


<!-- 
1. For your assigned Australian wild thing, read all you can about it, and write a paragraph describing it's key features, such as it's habitat, usual active time, whether numbers are increasing or declining, and even things like, if it is common for tourists to travel to see them, or there are special spotting promotions occurring as is happening [this month for the platypus](https://platypus.asn.au/report-a-sighting/). The write five unique expectations on what you might find when you explore the data, for example: 
<br><br>"We expect to see the occurrences only in the summer months."
<br>"We expect to find the most occurrences near the coast."
<br>"We expect to observe declining numbers since 1994."
<br><br> Be as specific as reasonably possible for your wild thing!
-->

### Key Features

The **Fairy Penguin**, also known as little penguin or little blue penguin (scientific name: *Eudyptula minor*) is the world's smallest penguin species, standing at just 41 cm tall and weighing under 1 kg. These penguins do not migrate, and can be found year-round inhabiting the coastal regions of Southern Australia, Tasmania, and New Zealand, with the largest colony residing on Phillip Island in Victoria [@phillip_island_nature_parks_guide_nodate]. They have also adapted to a primarily nocturnal lifestyle to avoid land and sea predators, spending most daylight hours at sea feeding [@seaworld_parks_entertainment_inc_fairy_nodate]. They eat various kind of sea creatures, such as red cod, anchovies, squid, and jellyfish, and can consume approximately 25% of their body weight per day [@phillip_island_nature_parks_guide_nodate]. Their flippers also enable them to swim easily underwater and survive for extended periods in the ocean. When night falls, Fairy Penguins return to land to rest and nest, often favoring sandy dunes, rocky areas, sea caves, and headlands for their nesting burrows [@wildlifevictoria]. Interestingly, they are the sole penguin species to breed on the Australian mainland, with their breeding season usually occurring between August to February; although, their colonies are now primarily limited to offshore islands due to habitat changes [@wildlifevictoria]. 


### Population Trends

Fairy Penguins also exhibit varying trends in population across different regions. According to @aquarium_of_the_pacific_little_nodate, the Fairy Penguin population is considered relatively stable, with approximately 1.2 million individuals. Additionally, Phillip Island hosts a thriving colony of over 40,000 penguins, making it a highly popular tourist attraction [@phillip_island_nature_parks_guide_nodate]. However, in several locations with highly urbanized areas and high predation, their numbers are declining. Fairy Penguins are very vulnerable to human interference, such as habitat destruction, overfishing, ecological disasters, and plastic pollution, as well as threats from predators, including foxes, weasels, ferrets, cats, and dogs. For instance, the only on-shore colony in New South Wales has been declared officially endangered [@nswdpe2019]. Over the past two decades, Granite Island in South Australia also experienced a significant decline of nearly 99% in its penguin population, primarily due to drought and predation, which led to a drop in penguin tour participants [@agius2022]. These regional variations suggest that the status of Fairy Penguins may be stable in some areas while declining in others, highlighting the need for ongoing conservation efforts.  

```{r image2, echo=FALSE, out.width = '100%'}
knitr::include_graphics("image2.jpg")
```

### Conservation Efforts

Phillip Island, located south of Melbourne, serves as an ideal habitat for the Fairy Penguin colony, and its conservation efforts have been remarkable. Initially facing a decline in numbers, the Victorian Government's Penguin Protection Plan, launched in 1985, has played a pivotal role in safeguarding these penguins [@phillip_island_nature_parks_guide_nodate]. Phillip Island is now a fox-free sanctuary where Fairy Penguins can breed safely. Phillip Island Nature Parks has also undertaken several conservation initiatives, including predator controls, habitat restoration, education, rehabilitation, and research studies aimed at better understanding these penguins [@penguin_foundation_little_nodate]. One notable engagement strategy is the Penguin Foundation's symbolic penguin adoption program, which encourages tourists to support conservation efforts [@penguinfoundation].

A popular attraction on Phillip Island is the "Penguin Parade," where hundreds of Fairy Penguins emerge from the sea each night and make their way to their burrows. This not only enhances the tourist experience but also generates funds through tourism, which are crucial for sustaining the sanctuary programs, ensuring the penguins' safety, and supporting ongoing research and monitoring activities. Phillip Island's multifaceted approach to penguin conservation serves as a model for protecting this unique species and their habitats [@phillip_island_nature_parks_guide_nodate].

### Expectations

Based on these facts, the five unique expectations we expect to find when exploring the data are:

1. We expect the number of penguin occurrences to increase after Phillip Island's implementation of the Penguin Protection Plan in the year 1985.

2. We anticipate higher numbers of penguin sightings during each breeding season, from August to February.

3. We anticipate that Victoria will have the highest number of penguin sightings compared to other regions or states.    

4) We expect to see fluctuations and potential declines in penguin occurrences in specific regions such as Granite Island (South Australia) and New South Wales over the past 20 years, given the impact of environmental factors.

5) We expect most penguin sightings to occur at sunset, due to the Fairy Penguins' nocturnal lifestyles. 

### Data Source

The occurrence data for Fairy Penguins is available on the [Atlas of Living Australia](https://www.ala.org.au/), a freely accessible online resource dedicated to Australia's biodiversity. The following sections will provide a comprehensive description of the data, outlining the procedures for data cleaning and organization. Following this, the **Initial Data Analysis** phase will ensure the data's readiness and relevance for our analytical objectives. In the **Exploratory Data Analysis** section, we will then visualize Fairy Penguin occurrences based on our expectations as previously outlined. Finally, the concluding section will provide a concise summary of our research findings.

**Limitations of Data Source**

Open and free data resources like the [Atlas of Living Australia](https://www.ala.org.au/) offer valuable information but come with certain limitations that should be considered when interpreting the data, namely:

1. **Data Quality:** The sightings data are recorded by a diverse group of contributors, ranging from penguin experts to enthusiastic non-experts. This variability in data collection methods and expertise can lead to inconsistencies in data quality, potentially affecting the reliability of the recorded sightings.

2. **Taxonomy Accuracy:** Species identification in the data may be prone to errors, as it relies on contributors who may not always be experts in penguin taxonomy. Misidentification of species can introduce inaccuracies into the dataset.

3. **Sampling Bias:** Data collection efforts may prioritize easily accessible areas or regions with a history of abundant penguin sightings. This sampling bias can result in an over-representation of certain areas while neglecting others, potentially skewing the overall picture of penguin occurrences.

4. **Incomplete Records:** Due to the diverse sources contributing to the dataset, it is possible that some records are incomplete, with missing or null values in one or more variables. These gaps in the data can limit the completeness and usability of the dataset for certain analyses.


## Data Description

<!--
2. Download all the occurrence records from the Atlas of Living Australia, ideally scripted using the `atlas_occurrences()` function from the `galah` package. Make sure you include date, time, collector identification details. Save this into a `data-raw` folder in your repo.
--> 

The dataset comprises penguin sighting records obtained from the [Atlas of Living Australia](https://www.ala.org.au/), focusing on penguin occurrences in the Australian region. It includes data from various years (starting from 1800), with observations up to the present year (2023). It consists of 18 variables with a total of approximately 680,330 observations.

```{r message = FALSE, warning = FALSE, echo = FALSE}

galah_config(email = "agoh0008@student.monash.edu",
             download_reason_id = 10, 
             verbose = TRUE)

penguins_raw <- galah_call()  %>% 
  galah_identify("Eudyptula minor") %>% 
  galah_select(basisOfRecord, recordedBy, recordedByID, eventType,
               group = c("basic", "event")) %>% 
  atlas_occurrences(mint_doi = TRUE)


save(penguins_raw, file=here::here("data-raw", "penguins_raw.rda"))

```

```{r message = FALSE, warning = FALSE, echo = FALSE}

galah_config(email = "agoh0008@student.monash.edu",
             download_reason_id = 10, 
             verbose = TRUE)

penguins_assert <- galah_call() %>% 
  galah_identify("Eudyptula minor") %>% 
  galah_select(group = "assertions") %>% 
  atlas_occurrences()

```

```{r message = FALSE, warning = FALSE, echo = FALSE}

penguins <- merge(penguins_raw, penguins_assert, by = "recordID", all = FALSE)

```

```{r message = FALSE, warning = FALSE, echo = FALSE}

penguins <- penguins %>% 
  select(recordID, decimalLatitude, decimalLongitude, eventDate, scientificName,
         taxonConceptID, dataResourceName, occurrenceStatus, eventRemarks, 
         eventTime, eventID, samplingEffort, samplingProtocol, basisOfRecord,
         recordedBy, recordedByID, eventType, BASIS_OF_RECORD_INVALID)

```


To ensure data quality and relevance to our analysis, we performed data cleaning and transformation procedures. Cleaning procedures involved merging the raw penguin occurrence data with assertion data and selecting a subset of variables. This process was conducted to refine the dataset for our analytical goals.

The dataset includes variables of different data types, such as character, numeric, logical, POSIXct, and POSIXt. Refer to the summary table below for a comprehensive overview of the dataset's variables:

```{r tableref, include=TRUE, message = FALSE, warning = FALSE, eval = TRUE, echo = FALSE, fig.height = 4, fig.width = 4}

descriptions <- c(
  "Unique identifier for the record",
  "Latitude of the occurrence",
  "Longitude of the occurrence",
  "Date and time of the sighting",
  "Scientific name of the species",
  "Concept ID for the taxon",
  "Name of the data resource",
  "Status of the sighting ('PRESENT' or 'ABSENT')",
  "Remarks about the sighting",
  "Time of the sighting",
  "Event ID",
  "Effort of sampling",
  "Protocol used for sampling",
  "Basis of the record (machine/human observation)",
  "Name of the recorder",
  "ID of the recorder",
  "Type of the sighting",
  "Invalid basis of record flag"
)


summary_table <- data.frame(Variable = names(penguins))

summary_table <- summary_table %>%
  mutate(Data_Type = sapply(penguins, class))

summary_table <- summary_table %>%
  rename("Data Type" = Data_Type)

summary_table$Description <- descriptions

kable(summary_table, "html", 
      caption = "Description of Variables (Penguins Raw Dataset)") %>%
  kable_styling() %>% 
  scroll_box(width = "600px", height = "200px")

```

Upon initial inspection of the data, there are several aspects that require attention and possible cleaning:

- **Geographical Data Cleaning**: Null values in `decimalLatitude` and `decimalLongitude` should be removed as these are essential for geographical visualizations and weather-sighting analysis.

- **Date Handling**: Null values in `eventDate` should be removed as well. The `eventDate` variable, currently in `dttm` format containing the year, month, date, and time in a single cell, needs to be further processed by splitting it into separate columns for year, month, day, and time.

- **Long Time Records:** Records dating back over a century need to be assessed for validity and data source reliability. 

- **Species Consistency:** As the `scientificName` variable includes both the species (*Eudyptula Minor*) and its subspecies (*Eudyptula Minor Novaehollandiae*), it is essential to scrutinize the data to prevent any double-counting between the two categories (i.e. ensuring that sightings of *Eudyptula Minor Novaehollandiae* are not mistakenly recorded as sightings of *Eudyptula Minor* as well).


## Initial Data Analysis

<!--
3. Perform a data quality check, and then go ahead and clean the data, saving only the wild sightings. Save the resulting data in a `data` folder as an `WILD_THING_COMMON_NAME.rda` file, so that any special variable types are clearly available. (Replace `WILD_THING_COMMON_NAME` with lower case common name of your assigned wild thing.) *Note:* Some are museum or historical records or live in an animal sanctuary or zoo, which do not truly capture their wild behaviour. Downloading the event information (`galah_select(group = "event")`) can help identify wild sightings.

Weather data pre-processing here too.
-->


### Data Cleaning for `penguins` dataset

Firstly, we excluded records where the `BASIS_OF_RECORD_INVALID` variable is marked as TRUE, which indicates unreliable or questionable data. As our subsequent analysis will involve geographical and time series exploration, we then addressed missing values by filtering out records with 'NA' values in the `eventDate`, `decimalLatitude` and `decimalLongitude` variables, ensuring that our analysis is based on complete and informative data entries. 

Furthermore, given our specific interest in assessing the effects of the Penguin Protection Plan implemented in 1985 on penguin occurrences, we restricted our dataset to records dated from January 1, 1980 onwards. This allows us to focus our analysis on a more recent and relevant timeframe, where we anticipate observing potential increases in the number of penguin occurrences following the plan's implementation. 

We also filtered out specific categories of records, including **"MATERIAL_SAMPLE"** **"PRESERVED_SPECIMEN"** and **"MATERIAL_CITATION"** to ensure that our dataset does not contain entries related to museum or historical records or instances from animal sanctuaries or zoos. These categories do not accurately capture the natural behaviors of penguins in the wild, which is our primary focus. Lastly, to ensure there are no duplicated records of penguin sightings between species and subspecies, we checked for double-counting based on the `recordID` field; there are 0 duplicated records, indicating that each sighting is unique.

```{r message = FALSE, warning = FALSE, echo = FALSE}

penguins <- penguins %>%
  filter(BASIS_OF_RECORD_INVALID != TRUE) %>%
  filter(!is.na(eventDate)) %>%
  filter(!is.na(decimalLatitude)) %>% 
  filter(!is.na(decimalLongitude)) %>% 
  filter(as.Date(eventDate) >= as.Date("1980-01-01")) %>% 
  filter(!(basisOfRecord %in% c("MATERIAL_SAMPLE", "PRESERVED_SPECIMEN", "MATERIAL_CITATION"))) 

sum(duplicated(penguins$recordID))

```

We then conduct an examination of how missing values impact our dataset. The table below provides insights into the extent of missing data within our dataset. Notably, the variables `eventRemarks`, `eventTime`, `eventID`, `samplingEffort`, `samplingProtocol`, `recordedBy`, `recordedByID`, and `eventType` exhibit a substantial number of missing values. While these variables may not be deemed critical for our immediate analysis, we have chosen to retain them due to concerns that their exclusion could significantly affect the outcome of our analysis. Retaining these variables allows us to preserve the available information and ensure that our analysis considers the entirety of the dataset. 

```{r message = FALSE, warning = FALSE, echo = FALSE}

missing_counts <- penguins %>%
  summarise_all(~ sum(is.na(.))) %>%
  gather(variable, count, everything())

kable(missing_counts, caption = "Missing Value Counts for Each Variable") %>% 
 scroll_box(width = "600px", height = "200px")

```

We utilized a series of visualizations to gain insights into the overall trends and patterns within the penguin sightings dataset. From @fig-1, it is evident that there was a notable and sharp increase in the number of penguin sightings around the early 2010s. This intriguing spike in sightings piqued our interest, prompting further investigation.

```{r message = FALSE, warning = FALSE, echo = FALSE}
#| label: fig-1
#| fig-cap: Number of Penguin Sightings Over Time (1980-2023)

penguins_year <- penguins %>%
  mutate(year = lubridate::year(eventDate)) %>% 
  filter(year >= 1980)

penguins_year <- penguins_year %>%
  group_by(year) %>%
  summarise(count = n())

ggplot(penguins_year, aes(x = year, y = count, group = 1)) +
  geom_line() +
  geom_point() +
  labs(
    x = "Year",
    y = "Number of Sightings",
    title = "Penguin Sightings Over Time (1980-2023)"
  ) +
  theme_minimal() + 
  scale_y_continuous(labels = scales::comma)

```

To understand the source of this increase, we employed a quasirandom scatterplot to visualize the `basisOfRecord` categories associated with these sightings. @fig-2 revealed that observations listed as **"MACHINE_OBSERVATION"** (i.e. data records generated and collected automatically by machines, sensors, or automated systems) displayed a significantly higher frequency compared to those with **"HUMAN_OBSERVATION"** and **"OBSERVATION"** as their basisOfRecord, particularly during the early 2010s. 

```{r message = FALSE, warning = FALSE, echo = FALSE}
#| label: fig-2
#| fig-cap: Temporal Trends in Penguin Sightings (1980-2023) Categorized by Different Bases of Record

penguins_basis <- penguins %>%
  mutate(year = lubridate::year(eventDate)) %>% 
  filter(year >= 1980)

penguins_basis <- penguins_basis %>%
  group_by(year, basisOfRecord) %>%
  summarise(count = n())

ggplot(penguins_basis, aes(x=year, 
                     y=count, 
                     colour=basisOfRecord)) +
    geom_quasirandom() +
  scale_color_brewer("", palette="Dark2") +
  scale_y_continuous(labels = scales::comma) +
  theme_bw() +
  labs(
    title = "Penguin Sightings by Basis of Record (1980-2023)"
  )


```

@fig-3 also reinforces our earlier observation. It is evident that **"MACHINE_OBSERVATION"** observations predominantly began around 2011-2012, with significantly high numbers ranging from 0 to 200,000. In contrast, **"HUMAN_OBSERVATION"** and **"OBSERVATION"** records, while present throughout the years, remained in a lower range of numbers, as indicated by the y-axis values, which typically ranged from 0 to 15,000. We can exclude **"OCCURRENCE"** records, considering there are only 3 observations, all in the year 1984. 

```{r message = FALSE, warning = FALSE, echo = FALSE}
#| label: fig-3
#| fig-cap: Distribution of Penguin Sightings (1980-2023) Categorized by Different Bases of Record

ggplot(penguins_basis, aes(x = year, 
                           y = count, 
                           fill = basisOfRecord)) +
  geom_col() +
  scale_color_brewer("", palette = "Dark2") +
  scale_y_continuous(labels = scales::comma) +
  theme_bw() +
  facet_wrap(~basisOfRecord, nrow = 3, scales = "free_y") +
  labs(
    title = "Distribution of Penguin Sightings by Basis of Record (1980-2023)"
  )


```

The table below summarizes the distribution of penguin sightings by data resource. Notably, GPS tracking data from Port Campbell, Victoria, contributed the most significantly to the dataset, with approximately 265,403 observations, followed by data from NSW BioNet Atlas and tracking data from Montague and Bowen Islands, New South Wales. @fig-4 also corroborates these findings, showing a spike in GPS tracking observations in Port Campbell in 2012, while tracking data from Montague and Bowen Islands began in the same year with a substantial count of 100,000 records. These data resources indicating machine-generated data also exhibited a subsequent decline in observations in the following years.

```{r message = FALSE, warning = FALSE, echo = FALSE}

# Check penguins data resource (if any museums, animal sanctuary/zoo)

penguin_counts <- penguins %>%
  group_by(dataResourceName) %>%
  summarise(penguin_count = n()) %>%
  arrange(desc(penguin_count))

kable(penguin_counts, caption = "Penguin Counts by Data Resource Name") %>% 
 scroll_box(width = "600px", height = "200px")

```

```{r message = FALSE, warning = FALSE, echo = FALSE}
#| label: fig-4
#| fig-cap: Penguin Sightings (2010-2015) Attributed to the Top Three Data Contributors

penguin_tes <- penguins %>% 
  filter(dataResourceName %in% c(
    "GPS tracking and dive data from 84 foraging trip tracks of Little Penguins (32 female, 31 male) , Port Campbell, Victoria, Australia (2012-2013)",
    "Tracking of Little Penguins (Eudyptula minor) from Montague and Bowen Islands, New South Wales coast, Australia (2012 - 2014)",
    "NSW BioNet Atlas"
  ))

penguin_tes %>%
  mutate(year = lubridate::year(eventDate)) %>%
  filter(year > 2009, year < 2016) %>%
  group_by(year, dataResourceName) %>%
  summarise(count = n()) %>%
  ggplot(aes(x = year, y = count, 
             color = str_wrap(dataResourceName, width = 25))) +  
  geom_line() +
  geom_point() +
  labs(
    x = "Year",
    y = "Number of Sightings",
    title = "Penguin Sightings (2010-2015) from Top 3 Contributors"
  ) +
  theme_minimal() + 
  scale_y_continuous(labels = scales::comma) +
  guides(
    color = guide_legend(
      title = "Data Sources",
      label.theme = element_text(size = 10)  
    )
  ) +
  theme(
    legend.key.width = unit(1, "cm")  
  )

```


In summary, given these findings, we should segregate the data into two categories: **"MACHINE_OBSERVATION"** and **"HUMAN_OBSERVATION/OBSERVATION."** The prevalence of machine-generated observations, particularly during specific periods, has the potential to skew our data and introduce variability that may not accurately reflect natural penguin behavior. By separating these records, this enables more consistent and comparable counts from one year to another, enhancing the stability and robustness of our data for further analysis. Furthermore, to provide a more granular perspective, we formatted the `eventDate` variable to extract and separate additional temporal information, such as year, month, day, day of the week, and time.

```{r message = FALSE, warning = FALSE, echo = FALSE}

penguins_human_records <- penguins %>%
  filter(basisOfRecord %in% c("HUMAN_OBSERVATION", "OBSERVATION")) %>% 
  mutate(year = lubridate::year(eventDate),
           month = lubridate::month(eventDate),
           day = lubridate::day(eventDate),
           day_of_week = lubridate::wday(eventDate, label = TRUE),
           time = format(eventDate, format = "%H:%M:%S")) %>%
    select(-eventDate)

penguins_machine_records <- penguins %>%
  filter(basisOfRecord == "MACHINE_OBSERVATION") %>% 
  mutate(year = lubridate::year(eventDate),
         month = lubridate::month(eventDate),
         day = lubridate::day(eventDate),
         day_of_week = lubridate::wday(eventDate, label = TRUE),
         time = format(eventDate, format = "%H:%M:%S")) %>%
  select(-eventDate)

```

```{r message = FALSE, warning = FALSE, echo = FALSE}

save(penguins_human_records,
     file=here::here("data/penguins_human_records.rda"))

save(penguins_machine_records,
     file=here::here("data/penguins_machine_records.rda"))

```


### Weather Data Pre-Processing

After retrieving meteorological data from the Global Historical Climatology Network (GHCN) database, we focused on Australian weather station locations and narrowed down on a specific weather station (i.e. "ASN00086373") in Rhyll, Phillip Island (Victoria) for our analysis, since it is expected to have one of the highest Fairy Penguin sightings relative to other locations (as shown in the map plots below). We pulled historical weather data for this station, specifically for the elements `prcp` (precipitation), `tmax` (maximum temperature), and `tmin` (minimum temperature), spanning from January 1, 1980, to September 13, 2023. 

```{r message = FALSE, warning = FALSE, echo = FALSE}

# get stations lat and long

aus_stations <- ghcnd_stations() |>
  filter(str_starts(id, "ASN")) |>
  filter(last_year >= 2020) |>
  mutate(wmo_id = as.numeric(wmo_id),
         name = str_to_lower(name)) |>
  select(-state, -gsn_flag) |>
  filter(element %in% c("PRCP", "TMAX", "TMIN")) |>
  nest(element: last_year) |>
  rowwise() |>
  filter(nrow(data) == 3) |>
  select(-data) 

```

```{r message = FALSE, warning = FALSE, echo = FALSE}

# map_loc_vic <- c(141, -39.5, 147, -37.5)
phil_loc <- c(145.2, -38.49)

# vic_map <- get_stamenmap(rbind(as.numeric(paste(geocode_OSM("Victoria, Australia")$bbox))), zoom = 7)
# save(vic_map,
#      file=here::here("data/vic_map.rda"))
load("data/vic_map.rda")

ggmap(vic_map) +
  geom_point(
    data = penguins_human_records,
    aes(x = decimalLongitude, y = decimalLatitude),
    color = "black",
    size = 0.6,
    alpha = 0.4
  ) +
  annotate("text", x = phil_loc[1], y = phil_loc[2], label = "Phillip Island", 
           color = "firebrick", size = 4, vjust = 4, hjust = 1) +
  annotate("segment", x = phil_loc[1] - 0.4, xend = phil_loc[1] - 0.15,
           y = phil_loc[2] - 0.25, yend = phil_loc[2] - 0.08,
           arrow = arrow(type = "closed", length = unit(0.08, "inches")), color = "firebrick") +
  labs(title = "Fairy Penguin Sightings in Victoria")+
  theme_map()

```


```{r message = FALSE, warning = FALSE, echo = FALSE}

# phil_map <- get_stamenmap(rbind(as.numeric(paste(geocode_OSM("Phillip Island, Australia")$bbox))),
#                           zoom = 12)
# save(phil_map,
#      file=here::here("data/phil_map.rda"))
load("data/phil_map.rda")

# show the nearest weather station to Phillip Island
phil_map_station <- ggmap(phil_map) +
  geom_point(data = aus_stations,
             aes(x = longitude, y = latitude, text = id),
             color = "firebrick", size = 3) +
  theme_map() +
  labs(title = "Weather Station in the Phillip Island Area")

ggplotly(phil_map_station, tooltip = "text")

```


To integrate the penguin sighting records with the weather data, we began by standardizing the date formats to ensure compatibility between the datasets. Next, we filtered the penguin sighting records based on geographic coordinates, selecting observations within a specific latitude and longitude range that corresponds to Phillip Island. We then performed a left join between the filtered penguin sighting data and the weather data, linking them by the common `date` variable. This join allowed us to combine the information from both datasets while retaining all the variables. Subsequently, we created a new binary variable called `sighting`, where we labeled each day as 1 if there was a penguin sighting recorded for that day (indicated by the presence of non-missing values in `decimalLatitude`, `decimalLongitude`, and `occurrenceStatus`), and as 0 if no penguin sighting was recorded. After creating the sighting variable, we grouped the data by date and calculated the total number of penguin sightings per day. Finally, we removed the grouping, resulting in a dataset that includes daily weather information and the corresponding binary variable indicating penguin sightings, along with the count of sightings per day.

The pre-processed data is then saved as a .rda file in our `data` directory, ensuring that the integrated dataset is readily available for further exploration and analysis in the exploratory data analysis (EDA) phase.



```{r message = FALSE, warning = FALSE, echo = FALSE}

# add weather data

rhyll <- aus_stations |>
  filter(id == "ASN00086373") |>
  rowwise() |>
  mutate(ts = list(meteo_pull_monitors(
    monitors = id, var = c("PRCP", "TMAX", "TMIN"),
    date_min = "1980-01-01",
    date_max = "2023-09-13") |>
      select(-id))) |>
  rename(lat = latitude, long = longitude, elev = elevation) |> select(id, long, lat, elev, name, wmo_id, ts) %>%
  unnest(ts) |>
  mutate(tmax = tmax/10, tmin = tmin/ 10)

```

```{r message = FALSE, warning = FALSE, echo = FALSE}

# format the date variable

penguins_human_records$date <- as.POSIXct(paste(penguins_human_records$year,
                                                penguins_human_records$month,
                                                penguins_human_records$day, 
                                                sep = "-"), 
                                          format = "%Y-%m-%d")

```


```{r message = FALSE, warning = FALSE, echo = FALSE}

# filter sightings in Phillip Island

phillip_island_penguins <- penguins_human_records %>% 
  filter(decimalLatitude > -38.57, decimalLatitude < -38.44,
         decimalLongitude > 145.09, decimalLongitude < 145.37)
  
```


```{r message = FALSE, warning = FALSE, echo = FALSE}

rhyll <- rhyll %>%
  left_join(phillip_island_penguins, by = "date") %>%
  mutate(
    sighting = ifelse(
      !is.na(decimalLatitude) &
      !is.na(decimalLongitude) &
      !is.na(occurrenceStatus),
      1,
      0
    )
  ) %>%
  group_by(date) %>%
  mutate(number_of_sightings = sum(sighting)) %>%
  ungroup()

```

```{r message = FALSE, warning = FALSE, echo = FALSE}

save(rhyll,
     file=here::here("data/rhyll.rda"))

```


## Exploratory Data Analysis

<!--
4. Make plots of the data to check each of your expectations, and report what you learn. *Note:* This might also be a place where visual inference methods *may* be useful to determine if what is seen agrees or disputes what you expected. 

Weather data exploration here too.
-->

#### We expect the number of penguin occurrences to increase after Phillip Island’s implementation of the Penguin Protection Plan in the year 1985.

The Penguin Protection Plan, initiated in 1985 by the Victorian Government, aimed to rehabilitate the Phillip Island area and create a safe haven for the Fairy Penguins. As the program's objective was to promote penguin conservation and protect their habitat, we expect the number of sightings to increase after 1985 (i.e. implementation of the plan). To assess the impact of the program on the penguin population, we filtered the data based on the following criteria:

1. Geographic Location: we focused on the Phillip Island area, where the program was primarily implemented. 
2. Timeframe: we filtered the years from 1980, five years before the program started, to 1995, ten years after the program began. This timeframe allows us to assess the program's impact on penguin sightings. Including years beyond 1995 could introduce unrelated variables that might confound the analysis.
3. Data Sources: we only included the sources that consistently recorded penguin sightings within the specified timeframe (1980-1995). There are only two sources that meet this criteria: "NSW BioNet Atlas" and "eBird Australia", as shown from the table below. These were chosen for their reliability and comprehensive coverage of the relevant years. 

```{r message = FALSE, warning = FALSE, echo = FALSE}

penguins_human_records %>% filter(year <= 1995) %>%
  group_by(year, dataResourceName) %>%
  count() %>%
  ungroup() %>%
  group_by(dataResourceName) %>%
  count() %>%
  arrange(-n) %>%
  kable(table.attr = 'data-quarto-disable-processing="true"') %>%
  kable_styling(full_width = FALSE)

```

The line graph below depicts the influence of The Penguin Protection Plan on the Fairy Penguin population in Phillip Island over the period from 1980 to 1995:

```{r message = FALSE, warning = FALSE, echo = FALSE}
#| label: fig-5
#| fig-cap: "Impact of the 1985 Penguin Protection Plan on Fairy Penguin Sightings"

plot_ppp <- penguins_human_records %>%
  filter(year <= 1995,
         dataResourceName %in% c("NSW BioNet Atlas", "eBird Australia"),
         decimalLatitude > -38.57, decimalLatitude < -38.44,
         decimalLongitude > 145.09, decimalLongitude < 145.37,) %>%
  group_by(year) %>%
  summarise(count = n()) %>%
  ggplot(aes(x = year, y = count)) +
  geom_line(color = "darkgrey") +
  geom_point(color = "aquamarine2", size = 2) +
  geom_vline(xintercept = 1985, color = "darkred", size = 0.75, alpha = 0.4) +
  annotate(geom = "text", x = 1985, y = 9000, label = "Penguin Protection Plan Initiated", size = 3.5, hjust = 1.02) +
  scale_x_continuous(breaks = seq(1980, 1995, by = 2)) +
  theme_minimal() +
  labs(title = "Effect of Conservation Plan on Fairy Penguin Sightings",
       subtitle = "Before and After Penguin Protection Plan",
       x = "Year",
       y = "Number of sightings")

ggplotly(plot_ppp )
  
```


As anticipated, @fig-5 exhibits a noticeable upward trend in sightings following the initiation of the Penguin Protection Plan in 1985. The count surged from approximately 831 in 1984 to nearly 12,000 in 1993, with a slight decline observed in the subsequent years.


#### We anticipate higher numbers of penguin sightings during each breeding season, from August to February.

The breeding season for Fairy Penguins is between August and February [@phillip_island_nature_parks_guide_nodate], hence we expect the number of sightings to rise within this time period. To conduct our analysis, we utilized data recorded from 1990 onwards to discern trends in penguin sightings following the implementation of the 1985 Penguin Protection Plan.

```{r message = FALSE, warning = FALSE, echo = FALSE} 
#| label: fig-6
#| fig-cap: "Monthly Distribution of Fairy Penguin Sightings (1990-2022)"

plot_monthly <- penguins_human_records %>%
  mutate(month = lubridate::month(month, label = TRUE)) %>%
  filter(year > 1990,
         year < 2023) %>%
  group_by(month) %>%
  summarise(count = n()) %>%
  ggplot(aes(x = month, y = count)) +
  geom_col(fill = "aquamarine4") +
  theme_minimal() +
  labs(
    title = "Fairy Penguin Sightings Grouped by Month (1990-2022)",
    x = "Month",
    y = "Number of sightings"
  )

ggplotly(plot_monthly)
```

@fig-6 shows a pronounced increase in penguin occurrences between August and February, which aligns with the Fairy Penguins' breeding season. This matches our initial expectation, as the numbers exhibited a steady rise starting in August, peaked in October/November before gradually declining toward the end of February.

To delve deeper into this pattern, we have generated yearly plots to provide a more detailed view of the sightings distribution:

```{r message = FALSE, warning = FALSE, echo = FALSE}
#| label: fig-7
#| fig-cap: "Daily Fairy Penguin Sightings (1990-2022) Faceted by Year"

plot_yearly <- penguins_human_records %>%
  filter(year > 1989,
         year < 2023) %>%
  mutate(day_of_year = lubridate::yday(date)) %>%
  # select(-date) %>%
  ggplot(aes(x = day_of_year)) +
  geom_histogram(bins = 40, fill = "darkseagreen") +
  facet_wrap( ~ year) +
  scale_y_log10() +
  scale_x_continuous(breaks = c(60, 213), labels=c("Mar", "Aug")) +
  labs(title = "Daily Fairy Penguin Sightings (1990-2022)",
       x = "",
       y = "Sightings") +
  theme_bw()

ggplotly(plot_yearly)

```

@fig-7 exhibits a discernible yearly pattern, with more occurrences recorded during the breeding season (August to February). This pattern remains pronounced, particularly within the first twelve years of the dataset. However, after this initial period, the number of sightings gradually decreased, making it challenging to ascertain a clear pattern.

Nonetheless, we can conduct an examination to determine the visibility of the sighting pattern in recent years. To do this, we created a visual inference test for the occurrences in the latest year, 2022, with the null hypothesis:

$H_0$: *There are similar numbers of Fairy Penguin monthly sightings throughout the year.*

```{r message = FALSE, warning = FALSE, echo = FALSE} 
#| label: fig-8
#| fig-cap: "Visual Inference Test for Monthly Fairy Penguin Sightings in 2022"

penguins_vi <- penguins_human_records %>% 
  filter(year == 2022) %>%
  group_by(month) %>%
  summarise(count = n()) 

set.seed(20230930)

method <- null_dist("count",
                    "uniform",
                    list(min = 69-33, max = 69+33)) #min/max = mean -/+ sd

lineup_df <- lineup(method, true = penguins_vi)

ggplot(lineup_df, aes(x = month, y = count)) +
  geom_smooth() +
  facet_wrap(~.sample) +
  guides(fill = FALSE) +
  theme(axis.text = element_blank(),
        axis.title = element_blank()) 

```

The null samples in @fig-8 are generated with `null_dist()` function from `nullabor` package. It creates a uniform distribution from the monthly count, effectively removing any pattern related to the breeding season. After presenting these null samples to eight individuals, seven of them were able to identify the true plot (plot 17) among the randomized samples.

```{r message = FALSE, warning = FALSE}

pval <- nullabor::pvisual(7, 8, 20)
pval
```

The calculated p-value is `r pval[3]`, essentially 0. Therefore, $H_0$ is rejected; the number of Fairy Penguin monthly sightings throughout the year is not similar. In other words, there is a clear pattern in fairy penguin sightings, and they are not uniformly distributed throughout the year. The records for the year 2022 show more occurrences during the breeding season (August to February) compared to other months.


#### We anticipate that Victoria will have the highest number of penguin sightings compared to other regions or states. 

```{r message = FALSE, warning = FALSE, echo = FALSE}
#| label: fig-9
#| fig-cap: "Temporal Trends in Penguin Sightings by Australian States (1980-2023)"

penguins_states <- penguins_human_records %>%
  filter(
    (decimalLatitude >= -37.020100 - 5 & decimalLatitude <= -37.020100 + 5 & decimalLongitude >= 144.964600 - 5 & decimalLongitude <= 144.964600 + 5) | # Victoria
    (decimalLatitude >= -30.000233 - 5 & decimalLatitude <= -30.000233 + 5 & decimalLongitude >= 136.209152 - 5 & decimalLongitude <= 136.209152 + 5) | # South Australia
    (decimalLatitude >= -25.042261 - 5 & decimalLatitude <= -25.042261 + 5 & decimalLongitude >= 117.793221 - 5 & decimalLongitude <= 117.793221 + 5) | # Western Australia
    (decimalLatitude >= -20.917574 - 5 & decimalLatitude <= -20.917574 + 5 & decimalLongitude >= 142.702789 - 5 & decimalLongitude <= 142.702789 + 5) | # Queensland
    (decimalLatitude >= -31.840233 - 5 & decimalLatitude <= -31.840233 + 5 & decimalLongitude >= 145.612793 - 5 & decimalLongitude <= 145.612793 + 5) | # New South Wales
    (decimalLatitude >= -41.640079 - 5 & decimalLatitude <= -41.640079 + 5 & decimalLongitude >= 146.315918 - 5 & decimalLongitude <= 146.315918 + 5)   # Tasmania
  )

penguins_states <- penguins_states %>%
  mutate(state = case_when(
    (decimalLatitude >= -37.020100 - 5 & decimalLatitude <= -37.020100 + 5 & decimalLongitude >= 144.964600 - 5 & decimalLongitude <= 144.964600 + 5) ~ "Victoria",
    (decimalLatitude >= -30.000233 - 5 & decimalLatitude <= -30.000233 + 5 & decimalLongitude >= 136.209152 - 5 & decimalLongitude <= 136.209152 + 5) ~ "South Australia",
    (decimalLatitude >= -25.042261 - 5 & decimalLatitude <= -25.042261 + 5 & decimalLongitude >= 117.793221 - 5 & decimalLongitude <= 117.793221 + 5) ~ "Western Australia",
    (decimalLatitude >= -20.917574 - 5 & decimalLatitude <= -20.917574 + 5 & decimalLongitude >= 142.702789 - 5 & decimalLongitude <= 142.702789 + 5) ~ "Queensland",
    (decimalLatitude >= -31.840233 - 5 & decimalLatitude <= -31.840233 + 5 & decimalLongitude >= 145.612793 - 5 & decimalLongitude <= 145.612793 + 5) ~ "New South Wales",
    (decimalLatitude >= -41.640079 - 5 & decimalLatitude <= -41.640079 + 5 & decimalLongitude >= 146.315918 - 5 & decimalLongitude <= 146.315918 + 5) ~ "Tasmania",
    TRUE ~ "Other"
  ))

penguins_states_summary <- penguins_states %>%
  group_by(year, state) %>%
  summarise(penguin_count = n())

states_penguin_plot <- ggplot(penguins_states_summary, aes(x = year, y = penguin_count, color = state)) +
  geom_line(size = 1, linetype = "solid", alpha = 0.5) +
  geom_point(size = 2, shape = 19) +
  labs(
    x = "Year",
    y = "Penguin Count (Log Scale)",
    title = "Penguin Sightings Over Time (1980-2023) by State"
  ) +
  scale_color_viridis_d() +
  theme_minimal() +
  theme_bw() +
  scale_x_continuous(breaks = seq(1980, 2023, by = 5)) +
  scale_y_log10(limits = c(1, max(penguins_states_summary$penguin_count) + 10)) +  
  guides(color = guide_legend(title = "State"))

ggplotly(states_penguin_plot)

```

@fig-9 illustrates Fairy Penguin sightings across the six Australian states from 1980 to 2023. Notably, Victoria consistently records the highest sightings throughout the entire period, aligning with our initial expectation that Victoria would have the highest number of penguin sightings compared to other states. Meanwhile, during the early years (1980s to late 1990s), New South Wales initially ranked second in sightings but was later overtaken by Tasmania in the mid-2000s. This shift reflects changes in Fairy Penguin populations and distributions, coinciding with New South Wales' only on-shore colony being declared officially endangered. Western Australia, on the other hand, consistently records the fewest sightings, with sporadic outliers in 2013, 2015, and 2017, likely due to less favorable penguin habitats. 

One interesting trend is the declining penguin sightings in Victoria since 2002. Similarly, New South Wales also experienced a sharp drop from the early 2000s onwards. Tasmania, on the contrary, saw a notable increase in the number of penguin sightings, especially during the later years (i.e., mid-2000s to 2023).   

#### We expect to see fluctuations and potential declines in penguin occurrences in specific regions such as Granite Island (South Australia) and New South Wales over the past 20 years, given the impact of environmental factors.

```{r message = FALSE, warning = FALSE, echo = FALSE}

penguins_decade <- penguins_human_records %>%
  mutate(state = case_when(
    (decimalLatitude >= -35.5499978 - 0.1 & 
       decimalLatitude <= -35.5499978 + 0.1 & 
       decimalLongitude >= 138.6166642 - 0.1 & 
       decimalLongitude <= 138.6166642 + 0.1) ~ "Granite Island",
    (decimalLatitude >= -31.840233 - 5 & 
       decimalLatitude <= -31.840233 + 5 &
       decimalLongitude >= 145.612793 - 5 & 
       decimalLongitude <= 145.612793 + 5) ~ "New South Wales"))

```


```{r message = FALSE, warning = FALSE, echo = FALSE}
#| label: fig-10
#| fig-cap: "Temporal Evolution of Penguin Sightings in Granite Island and New South Wales (1980-2023)"

penguins_decade <- penguins_decade %>%
  filter(state %in% c("Granite Island", "New South Wales"))

penguins_decade_plot <- ggplot(penguins_decade, 
                               aes(x = year, 
                                   y = ..count.., 
                                   fill = state)) +
  geom_bar() +
  labs(
    x = "Year",
    y = "Number of sightings",
    title = "Penguin Sightings Trend in Granite Island and New South Wales",
    fill = "State"
  ) +
  scale_fill_manual(values = brewer.pal(3, "Set2")) +  
  facet_wrap(~ state, scales = "free_y", ncol = 1) +
  theme_minimal()

ggplotly(penguins_decade_plot)

```

@fig-10 reveals distinct patterns in Fairy Penguin sightings trends between Granite Island (South Australia) and New South Wales throughout 1980-2023. Granite Island displays a right-skewed distribution, indicating a sharper decline in penguin sightings relative to New South Wales. Initially, from 1988 to 1992, Granite Island had a relatively high number of penguin sightings. However, after 1992, there was a significant drop in sightings, with annual counts consistently falling below 20, indicating that spotting penguins on Granite Island became increasingly rare.

This steep decline in Granite Island's Fairy Penguin population could be attributed to several factors, including prolonged drought conditions and increased predator presence. Notably, the decade-long drought at the nearby Murray Mouth, situated 25 kilometers east across Encounter Bay, impacted the region's ecosystem. This reduction in freshwater flow from Australia's largest river system into the Southern Ocean likely led to decreased fish populations, which are a crucial food resource for Fairy Penguins [@agius2022graniteisland].

On the other hand, New South Wales exhibits higher fluctuations in penguin sightings, with peaks in the mid to late 1990s. However, this region also experienced a decline in penguin sightings, particularly from the year 2000 onwards. The threat of fox attacks, exemplified by the 2015 incident where 27 penguins fell victim to foxes, could be a contributing factor to the declining trend. 

Overall, this analysis confirms our initial expectation that there are fluctuations and declines in penguin sightings within Granite Island and New South Wales over the past two decades, most likely contributed by environmental factors.

#### We expect most penguin sightings to occur at sunset, due to the Fairy Penguins' nocturnal lifestyles.

Fairy Penguins follow a distinctive behavioral pattern, leaving their burrows at dawn to venture into the sea for food and returning to land at dusk [@aquarium_of_the_pacific_little_nodate]. As such, we anticipate a higher frequency of penguin sightings during the sunset hours, coinciding with their return from hunting at sea. 

To ensure consistency with our previous analysis, we focused on data collected from 1990 onwards. Additionally, we excluded observations with a `00:00:00` value in the `time` variable. These values originally represented missing time information in the `eventDate` variable from the raw data; given their prevalence, retaining them could have potentially distorted the overall proportion of penguin sightings in our dataset.

```{r message = FALSE, warning = FALSE, echo = FALSE}
#| label: fig-11
#| fig-cap: "Hourly Patterns in Fairy Penguin Sightings (1990-2023)"

plot_return <- penguins_human_records %>% 
  filter(year > 1990,
         time != "00:00:00") %>%
  mutate(time = as.POSIXct(paste("0001-01-01", time))) %>%
  ggplot(aes(x = time)) +
  geom_histogram(bins = 30, fill = "steelblue", color = "white") +
  scale_x_datetime(date_breaks = "2 hours",
                   date_labels = "%H:%M") +
  theme_minimal() +
  labs(title = "Hourly Distribution of Fairy Penguin Sightings",
       subtitle = "1990 - 2023",
       x = "Time",
       y = "Number of sightings")
  
ggplotly(plot_return, tooltip = c("y"))

```

As shown in @fig-11, a distinct pattern emerges with a notable increase in sightings between 6am and 9am, as well as between 6pm and 9pm. This pattern aligns with our initial expectation that a greater number of penguin sightings would occur during dusk when the Fairy Penguins return to their burrows from hunting at sea. Moreover, it hints at the intriguing possibility that Fairy Penguins also prefer early morning departures for their sea journeys.


### Weather Data Analysis

#### Fairy Penguin Sightings vs Temperature

```{r message = FALSE, warning = FALSE, echo = FALSE}
#| label: fig-12
#| fig-cap: "Fairy Penguin Sightings by Season on Phillip Island"

rhyll2 <- rhyll %>%
  mutate(month = format(as.Date(date), "%b")) %>%
  mutate(season = case_when(
    month %in% c("Dec", "Jan", "Feb") ~ "Summer",
    month %in% c("Mar", "Apr", "May") ~ "Autumn",
    month %in% c("Jun", "Jul", "Aug") ~ "Winter",
    month %in% c("Sep", "Oct", "Nov") ~ "Spring"
  ))

ggplot(rhyll2 %>% 
                         filter(sighting == 1, !is.na(tmax)),
                       aes(x = tmax, 
                           y = number_of_sightings, 
                           color = season)) +
  geom_point() +
  facet_grid(.~season) +
  labs(
    x = "Maximum Temperature (°C)",
    y = "Number of Sightings",  
    color = "Season"
  ) +
  labs(
    title = "Fairy Penguin Sightings by Season (Phillip Island)", 
  ) +
  scale_color_viridis_d() +
  theme_minimal()


```

Our main interest is understanding how the number of penguin sightings varies with changes in daily maximum temperatures across different seasons. @fig-12 reveals a distinct seasonal variation, with spring (September-November) and summer (December-February) months exhibiting higher penguin sighting numbers, which aligns with the breeding and behavioral patterns of Fairy Penguins. This implies that, on average, warmer weather, especially during these seasons with higher daily temperatures, contributes to an overall increase in penguin sightings, as these birds are more active during their breeding period. 

However, a noteworthy observation is that within each season, there is a tendency for more penguin sightings on cooler days. For instance, there were approximately 303 penguin sightings in total on days with an average temperature of 25.6 degrees during summer, contrasting with only 105 sightings on days with a significantly higher temperature of 35.5 degrees. This paradoxical pattern within seasons, where cooler days attract more penguins, may be attributed to the thermoregulatory behavior of these birds, where they prefer to come ashore after dark to avoid overheating and potential predators. 

Additionally, the presence of intriguing outliers in both autumn and winter also indicates the influence of diverse environmental factors, such as food availability or local conditions, on penguin behavior. For instance, during autumn, a single data point at 13.6 degrees recorded 358 sightings, while during winter, a similar temperature of 13.5 degrees corresponded to a high count of 405 penguin sightings.

```{r message = FALSE, warning = FALSE, echo = FALSE}

rhyll %>%
  filter(sighting == 1) %>%
  mutate(year = year(date)) %>%
  group_by(year) %>%
  summarize(total_sightings = sum(number_of_sightings)) %>% 
  arrange(desc(total_sightings)) %>% 
  head()

```

```{r message = FALSE, warning = FALSE, echo = FALSE}
#| label: fig-13
#| fig-cap: "Penguin Sightings vs. Temperature on Phillip Island (1993)"

rhyll_1993 <- rhyll %>%
  filter(sighting == 1, !is.na(tmax), year(date) == 1993)

rhyll_1993_plot <- ggplot(rhyll_1993, aes(x = tmax, y = number_of_sightings, 
                       color = tmax)) +
  geom_point(size = 1, alpha = 0.5) +
  scale_color_viridis() +
  labs(
    x = "Maximum Temperature (°C)",
    y = "Number of Sightings",
    title = "Penguin Sightings vs. Temperature (Phillip Island, 1993)",
    color = "Maximum Temperature (°C)"
  ) +
  theme_minimal()

ggplotly(rhyll_1993_plot)

```

Among the observed years, 1993 stands out with the highest total Fairy Penguin sightings, making it a prime year for exploration. @fig-13 portrays the relationship between daily maximum temperatures and Fairy Penguin occurrences on Phillip Island in 1993. Notably, the plot does not show any consistent pattern in the data, suggesting a random relationship between temperatures and penguin sightings. While there is a remarkable outlier at 16.4 degrees Celsius with 346 penguin sightings, this does not imply a clear trend. 

In contrast however, higher temperatures seem to correspond with fewer sightings, and days with temperatures exceeding 30 degrees Celsius had fewer than 100 penguin sightings in total. These findings highlight the complex nature of penguin behavior and suggest that temperature, along with other factors, may not have a deterministic influence on their behavior in their natural habitat.


#### Fairy Penguin Sightings vs Precipitation

In addition to temperature data, we also have access to precipitation data, which holds valuable insights into penguin sightings on both wet and dry days.

```{r message = FALSE, warning = FALSE, echo = FALSE}

penguins_prcp <- rhyll %>%
  filter(!is.na(prcp),
         year > 1990,
         year < 2023) %>%
  mutate(prcp_type = ifelse(prcp > 2 , "wet", "dry"),
         month = lubridate::month(month, label = TRUE))

```

```{r message = FALSE, warning = FALSE, echo = FALSE}

ggmap(phil_map) +
  geom_point(data = penguins_prcp,
             aes(x = decimalLongitude, y = decimalLatitude, color = prcp_type),
             size = 1.5,
             alpha = 0.5) +
  scale_color_manual(values = brewer.pal(2, "Dark2")) +
  theme_map() +
  theme(legend.title = element_blank()) +
  labs(title = "Fairy Penguins Sightings",
       subtitle = "Phillip Island, 1980 - 2022")


```

Observing the map, it is evident that the majority of penguin sightings occur on dry days. This phenomenon could be attributed to the increased visibility and ease of spotting penguins during clear and rain-free conditions compared to rainy days. 

To delve deeper into this observation, we summarized the number of sightings on both dry and wet days. To achieve this, we group the data by month, as our earlier analysis revealed that certain months exhibit higher occurrences compared to others. Below is the summary table presenting the fairy penguin sightings:

```{r message = FALSE, warning = FALSE, echo = FALSE}

prcp_count <- penguins_prcp %>% group_by(month, prcp_type) %>%
  summarise(count = n()) %>%
  pivot_wider(names_from = prcp_type, values_from = count) %>%
  ungroup() %>%
  rename(dry_sightings = dry,
         wet_sightings = wet)

DT::datatable(prcp_count, 
  options = list(ordering = TRUE),
  caption = "Number of Penguin Sightings Grouped by Month (1980-2022)")

```

According to the table, it's evident that there were considerably more sightings on dry days compared to wet days. However, this discrepancy can be attributed to the fact that there were a greater number of days without rain. To provide a more equitable comparison, the next plot compares the occurrences by dividing the monthly-grouped sightings based on the number of dry or wet days. Subsequently, we scale the data to estimate the sightings per 30 days, as if the entire month were either dry or wet.

@fig-14 illustrates the number of sightings per 30 days, providing a fairer perspective on the data.

```{r message = FALSE, warning = FALSE, echo = FALSE}
#| label: fig-14
#| fig-cap: "Monthly Estimated Penguin Sightings per 30 Days on Dry and Wet Days (1980-2022)."


prcp_days <- penguins_prcp %>% group_by(month, date) %>%
  summarise(precipitation = ifelse("wet" %in% prcp_type, "wet", "dry")) %>%
  group_by(month) %>%
  summarise(dry_days = sum(precipitation == "dry"),
            wet_days = sum(precipitation == "wet"))
  
prcp <- merge(prcp_count, prcp_days, by = "month", all = TRUE)

prcp <- prcp %>% mutate(prop_dry_30 = round((dry_sightings / dry_days) * 30),
                        prop_wet_30 = round((wet_sightings / wet_days) * 30))

prpc_plot <- prcp %>% ggplot() +
  geom_line(aes(x = month, y = prop_dry_30, group = 1, color = "dry days", text = prop_dry_30, text2 = month)) +
  geom_line(aes(x = month, y = prop_wet_30, group = 1, color = "wet days", text = prop_wet_30, text2 = month)) +
  scale_color_manual(values = c("dry days" = "#E41A1C", "wet days" = "#377EB8")) +
  theme_minimal() +
  labs(title = "Monthly Fairy Penguin Sightings: Dry vs. Wet Days (1980-2022)",
       x = "Month",
       y = "Sightings estimate per 30 days") +
  theme(legend.title = element_blank())

ggplotly(prpc_plot, tooltip = c("text","text2")) %>%
  style(legendtitle = list(text = ""))


```

The number of sightings per 30 days on wet days was consistently higher throughout the year, with the blue line almost always positioned above the red line. Notably greater disparities emerged in July, August, September, and especially in November and January. This may be because in wet weather conditions, there is a likelihood of increased food availability for penguins near the shores, often attributed to heightened fish activity. This abundance of prey closer to the coast can entice the penguins to venture nearer to the shoreline, ultimately leading to more frequent sightings. In contrast, during dry days, penguins may need to hunt for food further into the ocean and might not return to their nests until they have successfully obtained food.  

Meanwhile, the significant differences in sightings between wet and dry days, especially from July through January (excluding October), are closely linked to the penguins' breeding season. This breeding cycle is marked by specific demands – a Fairy Penguin egg takes about five weeks to hatch, followed by three more weeks of constant chick care [@animal_corner_little_nodate]. During this time, parent penguins must make frequent trips between the sea and their nests to feed their offspring. This increased activity is particularly pronounced on wet days, as these conditions often lead to more abundant prey near the shoreline. Therefore, this phenomenon explains the higher sighting frequency on wet days, especially during the breeding season.


## Summary 

In conclusion, our analysis sheds light on Fairy Penguin behavior, habitat, and the impact of various factors on their population. From delving into their responses to weather fluctuations to understanding their distinctive breeding patterns, these insights contribute to a more comprehensive understanding of Fairy Penguins. Here are the key findings: 

- **Conservation Success**: The implementation of the Penguin Protection Plan in 1985 has yielded significant results, with a noticeable increase in penguin sightings. This success underscores the importance of proactive conservation measures and offers valuable lessons for future efforts, both on Phillip Island and in broader conservation initiatives.

- **Breeding Season Peaks:** Penguin sightings exhibited significant peaks during the breeding season, from August to February, aligning with the Fairy Penguins' breeding and behavioral patterns. This surge in sightings during the breeding season can be attributed to various factors, including the emergence of new chicks from their burrows. 

- **Victoria Dominates Sightings:** Victoria consistently recorded the highest number of penguin sightings compared to other states, with notable fluctuations in New South Wales and Tasmania.

- **Declines in Specific Regions:** There were declines in penguin sightings in specific regions such as Granite Island (South Australia) and New South Wales over the past two decades, likely influenced by environmental factors.

- **Sightings at Sunset:** Our expectation that most penguin sightings would occur at sunset was confirmed, reflecting the Fairy Penguins' nocturnal lifestyle. The daily occurrence pattern reveals increased sightings both at sunset (around 6-9 pm) and dawn as well (between 6-9 am). This aligns with the behavior of Fairy Penguins, as they leave their nests at dawn to hunt for food and return home at dusk to rest.

- **Temperature and Sightings:** Warmer seasons, particularly during the months within the breeding season, generally contributed to increased penguin sightings. However, within each season, cooler days attracted more penguins, possibly due to thermoregulatory behavior.

- **Precipitation and Sightings:** Penguin sightings were more frequent on wet days, especially during the breeding season, likely because wet weather leads to increased food availability near the shoreline, influencing penguin behavior.


## References



